<?php

class ModuleBox extends Module
{
  function __construct($name)
  {
    parent::__construct($name);
    if (self::$debug || $this->localdebug)
      $this->doDebug("ModuleServlet->__construct()", WADebug::SYSTEM);
  }

  public function start($protocol)
  {

    // Register hook to process requests
    $protocol->registerHook('process', $this->name, "process");
  }

  public function process($request, $response)
  {
    if (self::$debug || $this->localdebug)
      $this->doDebug("ModuleBox->process($request, $response)", WADebug::SYSTEM);

    if ($response->content)
      return;

    $path = $request->getRequest('path');
    if (substr($path, 0, 5) != '/box/')
      return;

    if (self::$debug || $this->localdebug)
      $this->doDebug("ModuleBox: request accepted", WADebug::SYSTEM);

    $data = 'BOX OK';

    $response->content = true;
    $response->setBody($data);
    $response->setHeader('Content-Length', $response->getBodyLength());
  }
}

?>